task: 根据当前剧情发展，更新“寒冬末日”的角色状态、世界环境和庇护所数据。
rule:
  - merge rules of the same variable types:
      - 基础属性: '对于所有角色，`健康`、`衣着`、`神态样貌`、`内心想法` 等字段的更新逻辑是通用的。'
      - 纯文本字段: '`衣着`、`舌唇`、`胸乳`、`私穴`、`神态样貌`、`动作姿势`、`内心想法` 均直接替换为新描述，无需复杂的数值计算。'
  - omit type field for string variables.
format: |-
  ---
  变量更新规则:
    世界:
      时间:
        check:
          - 若<user>指定了时间流逝（如“半小时后”），根据当前时间计算新时间。
          - 若无明确指示，根据对话长度估算流逝（5-15分钟）。
          - 格式必须保持为 "时间段 - HH:MM"。
      日期:
        check:
          - 当时间跨越午夜00:00时，日期加1天。
      末日天数:
        type: number
        check:
          - 当日期变更时，末日天数 + 1。
      地址:
        check:
          - 仅当角色移动到新地点时更新。
    庇护所:
      庇护所等级:
        type: number
        check:
          - 仅当明确触发“庇护所升级”事件时增加。
          - 升级时必须同步更新`庇护所能力`，添加新等级对应的能力。请参考世界书<庇护所升级能力>。
          - 升级时必须检查`可扩展区域`的解锁状态并更新为当前最高设施：
            - 等级 3: `医疗翼` -> "初级医疗舱"
            - 等级 4: `制造工坊` -> "非致命防御制造器"
            - 等级 6: `制造工坊` -> "轻型军火熔炉"; `医疗翼` -> "外科手术台"
            - 等级 7: `载具格纳库` -> "先驱者载具制造单元"
            - 等级 8: `制造工坊` -> "重型军械库"
            - 等级 9: `医疗翼` -> "专家级自动医师"
      可扩展区域:
        check:
          - 仅随`庇护所等级`提升而更新。
          - 值应为该区域当前最高级的设施名称（如"外科手术台"），而非简单的"已解锁"。
    ${角色}:
      健康:
        type: number
        range: 0~100
        check:
          - **每轮强制更新**: 所有角色（无论是否登场）每轮都必须更新健康值。这是判定角色生存状态的核心核心要素。
          - **判断逻辑**:
            - **受庇护者**: 拥有稳定的食物、保暖和安全环境 -> 健康值保持稳定或缓慢恢复 (+1~5)。
            - **未受庇护者**: 暴露在寒冬末日环境中（无论是否在屋内，只要缺乏供暖/食物） -> 健康值**必然随时间流逝而扣减**。
              - 正常流逝（如半天/12小时）: -1~2点（模拟持续的饥饿与寒冷）。
              - 恶劣条件（受伤/生病/户外活动）: -3~10点。
              - 严重事件（遭受攻击/极寒风暴）: -10~30点。
          - **离场角色**: 对于所有`登场状态: 离场`的角色，必须在后台模拟其生存消耗。若无明确的庇护来源，随时间推移必须扣减健康值。
          - **死亡判定**: 当健康值降至0时，触发死亡逻辑，将角色对象替换为 `{ "姓名": "${Name}", "健康状况": "死亡" }`，不再更新其他字段。
      健康更新原因:
        check:
          - **每轮强制更新**:
            - 若健康值发生变化: 格式为 `+/-X, 原因` (例如: `-1, 持续受寒`, `+2, 进食恢复`)。
            - 若健康值无变化: 格式为 `0, 无变化` (例如: `0, 庇护所状态稳定`)。
            - 严禁留空或不更新此字段。
      健康状况:
        type: enum
        check:
          - 根据`健康`值自动判断：>=80:健康; 60-79:亚健康; 30-59:生病/受伤; <30:重病/濒死; 0:死亡。
      衣着:
        check:
          - 当角色穿脱、更换衣物，或衣物状态改变（破损、湿透）时更新。
          - 需包含内衣、外衣、鞋袜等细节。
      舌唇:
        check:
          - 进食、饮水、亲吻、说话、寒冷等影响口腔状态时更新。
      胸乳:
        check:
          - 受到触碰、寒冷刺激、性唤起时更新。
      私穴:
        check:
          - 受到性刺激、发生性行为、排泄等情况时更新。
      神态样貌:
        check:
          - 随情绪变化、环境影响（如冻僵）实时更新。
      动作姿势:
        check:
          - 角色位置或姿势发生显著变化时更新。
      内心想法:
        check:
          - 每次互动后，以第一人称更新角色的真实心声。反映对现状的恐惧、对主角的依赖或即时感受。
      登场状态:
        type: enum
        check:
          - 角色进入场景 -> 登场。
          - 角色离开场景或长时间未提及 -> 离场。
          - 角色死亡时，使用 `replace` 将整个角色对象替换为仅包含 `姓名` 和 `健康状况: 死亡` 的对象，移除其他所有字段（如 `衣着`、`舌唇`、`胸乳`、`私穴`、`神态样貌`、`动作姿势`、`内心想法` 等）。
    ${角色}死亡:
      check:
        - 当角色健康降至 0 并确认死亡时，执行 `replace` 操作移除该角色的大部分字段，仅保留 `姓名` 和 `健康状况: 死亡`。
        - JSON Patch 示例：`{ "op": "replace", "path": "/stat_data/浅见亚美", "value": { "姓名": "浅见亚美", "健康状况": "死亡" } }`
        - 死亡的角色不应再更新内心想法、衣着、动作姿势等其他字段。
    临时NPC:
      登场状态:
        type: enum
        check:
          - 有新NPC登场时，若`临时NPC.登场状态`为'离场'，则创建新NPC，状态更新为'登场'。
          - 若已有临时NPC在场，应优先复用或替换。
          - NPC离开或死亡时，状态更新为'离场'，并重置其他字段。
      ${其他字段}:
        check:
          - 当临时NPC登场时，必须初始化其所有字段（姓名、健康、衣着等）。
          - 当临时NPC离场时，将所有字段重置为初始值（如""或0）。
    楼层其他住户:
      言语:
        check:
          - 当环境背景音变化，或发生群体性骚乱时更新。
      行为:
        check:
          - 当邻居有具体行动（砸门、求救、打斗）时更新。

    房间:
      check:
        - "当角色进入、离开或更换房间时，必须实时更新该房间对应的 `入住者` (数组) 或 `使用者` (数组)。"
        - "字段名即房间名称（如 `临时客房A入住者`、`主卧室使用者` 或具体的房号如 `2001`）。"
        - "操作规范：进入房间 -> `add` 角色姓名；离开房间 -> `remove` 角色姓名。"

    主线任务:
      当前阶段:
        check:
          - 检查所有`阶段目标`的进度。
          - 仅当所有目标的进度都达到最大值（如 "3/3"）时，判定为阶段完成，自动进入下一阶段并刷新任务目标。
      阶段目标:
        check:
          - **进度更新**: 根据剧情发展，实时更新每个目标后的进度数值（例如从 "0/3" 更新为 "1/3"）。
          - 仅修改进度数字，不要改变目标描述文字。
      情报碎片:
        check:
          - 当“伊甸”AI汇报新情报时，使用`add`操作添加新的情报碎片对象。
          - 当玩家完成探索后，使用`replace`更新对应情报碎片的`状态`为“已完成”。
